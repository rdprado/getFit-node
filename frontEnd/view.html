<script src="./node_modules/vue/dist/vue.js"></script>
<script src="./node_modules/vue-resource/dist/vue-resource.js"></script>

<div id="my_view">

    <div id="addWorkout">
        <p> Add Workout </p>
        <input v-model="dateMonth" placeholder="Month">
        <input v-model="dateDay" placeholder="Day">
        <input v-model="dateYear" placeholder="Year">
        <br>
        <input v-model="name" placeholder="Name">
        <br>
        <textarea v-model="comments" placeholder="Comments"></textarea>
        <br>
        <button v-on:click="addWorkout">Add</button>
    </div>
	<br>
	
	<div id="weeklyWorkouts">
		<div id="weekControls">
			<button v-on:click="previousWeek"> < </button>
			<span>{{ currentWeek }} <span>
			<button v-on:click="nextWeek"> > </button>
		</div>
		<!-- TODO: https://softwareengineering.stackexchange.com/questions/277778/why-are-people-making-tables-with-divs -->
		<div id="">
			<table>
				<tr>
					<th>Day</th>
					<th>Workouts</th>
					<th>Duration</th>
				</tr>
				<!--<tr v-for="dayData in daysData">
					<td>dayData.weekDayName</td>
					<td>dayData.Activity</td>
					<td>dayData.Duration</td>
				</tr>-->
			</table>
			<table>
				<tr>
					<th>Day</th>
					<th>Workouts</th>
					<th>Duration</th>
				</tr>
				<tr>
					<td>Monday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Tuesday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Wednesday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Thursday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Friday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Saturday</td>
					<td>Running</td>
					<td>1 hour</td>
				</tr>
				<tr>
					<td>Sunday</td>
					<td>Running</td>
					<td>15 min</td>
				</tr>
			</table>
		</div>
		
	</div>
	
    <div id="workouts">
        <p>Workouts</p>

        <ul id="workouts">
            <li v-for="workout in workouts">
                <p>{{ workout.date}}</p>
                <p>{{ workout.title  }}</p>
                <p>{{ workout.comments}}</p>
                <button v-on:click="removeWorkout(workout.ID)">X</button>
            </li>
        </ul>
    </div>
</div>

<script>


var formatWeekInterval = function(beginDate, endDate) {
	return formatWeekDate(beginDate) + " - " + formatWeekDate(endDate);
}

var formatWeekDate = function(date) {
	var d = date;
	var curr_date = d.getDate();
	var curr_month = d.getMonth() + 1; //Months are zero based
	var curr_year = d.getFullYear();
	return curr_date + "/" + curr_month + "/" + curr_year;	
}

var currentWeekStart = "";
var currentWeekEnd = "";

new Vue({
    el: '#my_view',
    data: {
        dateDay: 2,
        dateMonth: 4,
        dateYear: 1999,
        name: '',
        comments: '',
        workouts: '',
		currentWeek: ''
    },
    methods: {
        removeWorkout: function(workoutID) {
            this.$http.post('http://localhost:3000/workouts/remove', {
                ID: workoutID}).then(response => {
                    this.workouts = response.body;
                    console.log('sucess');
                    // success callback
                }, response => {
                    console.log('error');
                    // error callback
                });
        },
        addWorkout: function(event) {
            this.$http.post('http://localhost:3000/workouts/add', {
                dateYear:this.dateYear,
                dateMonth:this.dateMonth, 
                dateDay:this.dateDay, 
                title:this.name, 
                comments: this.comments}).then(response => {
                    this.workouts = response.body;
                    console.log('sucess');
                    // success callback
                }, response => {
                    console.log('error');
                    // error callback
                });
        },
		previousWeek: function() {
		
			var prevWeekFinalDay = currentWeekStart.getDate() - 1;
			
			// SET CURRENT WEEK NEW END		
			var currentWeekStartCpy = new Date(currentWeekStart);
			currentWeekEnd = new Date(currentWeekStartCpy.setDate(prevWeekFinalDay));
			
			// SET CURRENT WEEK NEW START
			var currentWeekEndCpy = new Date(currentWeekEnd);
			currentWeekStart = new Date(currentWeekEndCpy.setDate(prevWeekFinalDay - 6));
			
			// PRESENT TODO same as below
			this.currentWeek = formatWeekInterval(currentWeekStart, currentWeekEnd);
        },
		nextWeek: function() {
		
			var nextWeekFirstDay = currentWeekEnd.getDate() + 1;
			// SET CURRENT WEEK NEW START
				var currentWeekEndCpy = new Date(currentWeekEnd);				
				currentWeekStart = new Date(currentWeekEndCpy.setDate(nextWeekFirstDay));
			
			// SET CURRENT WEEK NEW END
				var currentWeekStartCpy = new Date(currentWeekStart);
				currentWeekEnd = new Date(currentWeekStartCpy.setDate(nextWeekFirstDay + 6));
			
			// PRESENT
			this.currentWeek = formatWeekInterval(currentWeekStart, currentWeekEnd);
        },
    },
    mounted: function() {
            var now = new Date();
            this.dateDay =  now.getDate();
            this.dateMonth =  now.getMonth() + 1;
            this.dateYear =  now.getFullYear();
			
			// SET WEEK START BASED ON NOW
			
			var day = now.getDay();
			var diff = now.getDate() - day + (day == 0 ? -6:1); // adjust when day is sunday
			currentWeekStart = new Date(now.setDate(diff));
			
			// SET WEEK END
			
			var currentWeekStartCpy = new Date(currentWeekStart);
			var currentWeekStartDayInMonth = currentWeekStartCpy.getDate();
			currentWeekEnd = new Date(currentWeekStartCpy.setDate(currentWeekStartDayInMonth + 6));
			
			this.currentWeek = formatWeekInterval(currentWeekStart, currentWeekEnd);


            this.$http.get('http://localhost:3000/workouts').then(response => {
                this.workouts = response.body;
                console.log('sucess');
                // success callback
            }, response => {
                console.log('error');
                // error callback
            });
    }

})
</script>
