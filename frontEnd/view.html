<script src="./node_modules/vue/dist/vue.js"></script>
<script src="./node_modules/vue-resource/dist/vue-resource.js"></script>

<div id="my_view">

    <div id="addWorkout">
        <p> Add Workout </p>
        <input v-model="dateMonth" placeholder="Month">
        <input v-model="dateDay" placeholder="Day">
        <input v-model="dateYear" placeholder="Year">
        <br>
        <input v-model="name" placeholder="Name">
        <br>
        <textarea v-model="comments" placeholder="Comments"></textarea>
        <br>
        <button v-on:click="addWorkout">Add</button>
    </div>
	<br>
    <div id="workouts">
	<button v-on:click="previousWeek"> < </button>
	<span>{{ currentWeek }} <span>
	<button v-on:click="nextWeek"> > </button>
	
        <p>Workouts</p>

        <ul id="workouts">
            <li v-for="workout in workouts">
                <p>{{ workout.date}}</p>
                <p>{{ workout.title  }}</p>
                <p>{{ workout.comments}}</p>
                <button v-on:click="removeWorkout(workout.ID)">X</button>
            </li>
        </ul>
    </div>
</div>

<script>

new Vue({
    el: '#my_view',
    data: {
        dateDay: 2,
        dateMonth: 4,
        dateYear: 1999,
        name: '',
        comments: '',
        workouts: '',
		currentWeek: '',
		pvt: {
			currentWeekStart: "",
			currentWeekEnd: "",
			formatWeekDate: function(date) {
				var d = prevWeekFinalDate
				var curr_date = d.getDate();
				var curr_month = d.getMonth() + 1; //Months are zero based
				var curr_year = d.getFullYear();
				var sundayFormatted = curr_date + "/" + curr_month + "/" + curr_year;	
				this.pvt.currentWeekEnd = new Date(d);
			}
		}
    },
    methods: {
        removeWorkout: function(workoutID) {
            this.$http.post('http://localhost:3000/workouts/remove', {
                ID: workoutID}).then(response => {
                    this.workouts = response.body;
                    console.log('sucess');
                    // success callback
                }, response => {
                    console.log('error');
                    // error callback
                });
        },
        addWorkout: function(event) {
            this.$http.post('http://localhost:3000/workouts/add', {
                dateYear:this.dateYear,
                dateMonth:this.dateMonth, 
                dateDay:this.dateDay, 
                title:this.name, 
                comments: this.comments}).then(response => {
                    this.workouts = response.body;
                    console.log('sucess');
                    // success callback
                }, response => {
                    console.log('error');
                    // error callback
                });
        },
		previousWeek: function() {
		
			var prevWeekFinalDay = this.pvt.currentWeekStart.getDate() - 1;
			var currentWeekStartCpy = new Date(this.pvt.currentWeekStart);
			var prevWeekFinalDate = new Date(currentWeekStartCpy.setDate(prevWeekFinalDay));
			
			var d = prevWeekFinalDate
			var curr_date = d.getDate();
			var curr_month = d.getMonth() + 1; //Months are zero based
			var curr_year = d.getFullYear();
			var sundayFormatted = curr_date + "/" + curr_month + "/" + curr_year;	
			this.pvt.currentWeekEnd = new Date(d);
			
			
			var prevWeekFirstDate = new Date(prevWeekFinalDate.setDate(prevWeekFinalDay - 6));
									
			d = prevWeekFirstDate;
			curr_date = d.getDate();
			curr_month = d.getMonth() + 1; //Months are zero based
			curr_year = d.getFullYear();
			
			var mondayFormatted = curr_date + "/" + curr_month + "/" + curr_year;
			this.pvt.currentWeekStart = new Date(d);
			
			
			this.currentWeek = mondayFormatted + " - " + sundayFormatted;

        },
		nextWeek: function() {
		
			var nextWeekFirstDay = this.pvt.currentWeekEnd.getDate() + 1;
			var currentWeekEndCpy = new Date(this.pvt.currentWeekEnd);		
			var nextWeekFirstDate = new Date(currentWeekEndCpy.setDate(nextWeekFirstDay));
									
			var d = nextWeekFirstDate;
			var curr_date = d.getDate();
			var curr_month = d.getMonth() + 1; //Months are zero based
			var curr_year = d.getFullYear();
			
			var mondayFormatted = curr_date + "/" + curr_month + "/" + curr_year;
			this.pvt.currentWeekStart = new Date(d);
			
			var nextWeekFinalDay = new Date(nextWeekFirstDate.setDate(nextWeekFirstDay + 6));
			d = nextWeekFinalDay
			curr_date = d.getDate();
			curr_month = d.getMonth() + 1; //Months are zero based
			curr_year = d.getFullYear();
						
			var sundayFormatted = curr_date + "/" + curr_month + "/" + curr_year;
			this.pvt.currentWeekEnd = new Date(d);
			
			this.currentWeek = mondayFormatted + " - " + sundayFormatted;
        }
    },
    mounted: function() {
            var now = new Date();
            this.dateDay =  now.getDate();
            this.dateMonth =  now.getMonth() + 1;
            this.dateYear =  now.getFullYear();
			
			var day = now.getDay();
			var diff = now.getDate() - day + (day == 0 ? -6:1); // adjust when day is sunday
			var monday = new Date(now.setDate(diff));
			var sunday = new Date(now.setDate(diff + 6));
			
			var d = monday;
			var curr_date = d.getDate();
			var curr_month = d.getMonth() + 1; //Months are zero based
			var curr_year = d.getFullYear();
			
			this.pvt.currentWeekStart = d;
			
			var mondayFormatted = curr_date + "/" + curr_month + "/" + curr_year;
			
			d = sunday
			curr_date = d.getDate();
			curr_month = d.getMonth() + 1; //Months are zero based
			curr_year = d.getFullYear();
			var sundayFormatted = curr_date + "/" + curr_month + "/" + curr_year;
			
			this.pvt.currentWeekEnd = d;
						
			this.currentWeek = mondayFormatted + " - " + sundayFormatted;

            this.$http.get('http://localhost:3000/workouts').then(response => {
                this.workouts = response.body;
                console.log('sucess');
                // success callback
            }, response => {
                console.log('error');
                // error callback
            });
    }

})
</script>
